---
globs: src/services/**/*
description: API å¼€å‘è§„èŒƒ - Services ç›®å½•ç»“æ„ã€ç±»å‹å‘½åè§„èŒƒã€API æ–¹æ³•å®šä¹‰
---

# API å¼€å‘è§„èŒƒ

## ğŸ“ ç›®å½•ç»“æ„

Services æ¨¡å—æŒ‰ä¸šåŠ¡æ¨¡å—åˆ’åˆ†ï¼Œæ¯ä¸ªæ¨¡å—åŒ…å« API æ–¹æ³•å®šä¹‰å’Œç±»å‹å®šä¹‰ï¼š

```
src/services/
â”œâ”€â”€ index.ts              # ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ API å’Œç±»å‹
â”œâ”€â”€ user/                 # ç”¨æˆ·æ¨¡å—
â”‚   â”œâ”€â”€ index.ts         # API æ–¹æ³•å®šä¹‰
â”‚   â””â”€â”€ types.ts         # ç±»å‹å®šä¹‰
â”œâ”€â”€ product/             # äº§å“æ¨¡å—
â”‚   â”œâ”€â”€ index.ts
â”‚   â””â”€â”€ types.ts
â””â”€â”€ order/               # è®¢å•æ¨¡å—
    â”œâ”€â”€ index.ts
    â””â”€â”€ types.ts
```

## ğŸ·ï¸ ç±»å‹å‘½åè§„èŒƒ

### æ ¸å¿ƒè§„åˆ™ï¼šä½¿ç”¨æ¨¡å—å‰ç¼€å‘½å

**æ‰€æœ‰ç±»å‹å¿…é¡»ä½¿ç”¨æ¨¡å—å‰ç¼€å‘½åï¼Œé¿å…ä¸åŒæ¨¡å—é—´çš„ç±»å‹é‡å¤å’Œå‘½åå†²çªã€‚**

æ ¼å¼ï¼š`æ¨¡å—å + ç±»å‹æè¿°`

### å‘½åçº¦å®šè¡¨

| ç±»å‹ç”¨é€”  | å‘½åæ ¼å¼                   | ç¤ºä¾‹                                       |
| --------- | -------------------------- | ------------------------------------------ |
| ä¿¡æ¯/å®ä½“ | `æ¨¡å—å + Info`            | `UserInfo`, `ProductInfo`                  |
| åˆ—è¡¨é¡¹    | `æ¨¡å—å + Item`            | `UserItem`, `ProductItem`                  |
| è¯·æ±‚å‚æ•°  | `æ¨¡å—å + æ“ä½œ + Params`   | `UserLoginParams`, `ProductCreateParams`   |
| å“åº”æ•°æ®  | `æ¨¡å—å + æ“ä½œ + Response` | `UserLoginResponse`, `ProductListResponse` |
| çŠ¶æ€æšä¸¾  | `æ¨¡å—å + Status`          | `OrderStatus`, `UserStatus`                |
| ç±»å‹æšä¸¾  | `æ¨¡å—å + Type`            | `ProductType`, `OrderType`                 |

### ç¤ºä¾‹å¯¹æ¯”

```typescript
// âŒ é”™è¯¯ - æ²¡æœ‰æ¨¡å—å‰ç¼€
export interface Info {}
export interface Params {}
export interface Response {}

// âœ… æ­£ç¡® - ä½¿ç”¨æ¨¡å—å‰ç¼€
export interface UserInfo {}
export interface UserLoginParams {}
export interface UserLoginResponse {}
```

## ğŸ“ types.ts - ç±»å‹å®šä¹‰æ–‡ä»¶

**èŒè´£**ï¼šå®šä¹‰è¯¥æ¨¡å—ç›¸å…³çš„æ‰€æœ‰ TypeScript ç±»å‹

### ç¤ºä¾‹ï¼šç”¨æˆ·æ¨¡å—ç±»å‹å®šä¹‰

å‚è€ƒæ–‡ä»¶ï¼š[src/services/user/types.ts](mdc:src/services/user/types.ts)

```typescript
/**
 * ç”¨æˆ·ç›¸å…³ç±»å‹å®šä¹‰
 */

// ç”¨æˆ·ä¿¡æ¯
export interface UserInfo {
  id: number
  username: string
  email: string
  avatar?: string
  phone?: string
}

// ç™»å½•å‚æ•°
export interface UserLoginParams {
  username: string
  password: string
}

// ç™»å½•å“åº”
export interface UserLoginResponse {
  token: string
  userInfo: UserInfo
}

// æ›´æ–°ç”¨æˆ·ä¿¡æ¯å‚æ•°
export interface UserUpdateParams {
  email?: string
  avatar?: string
  phone?: string
}

// ç”¨æˆ·çŠ¶æ€æšä¸¾
export enum UserStatus {
  Active = 'active',
  Inactive = 'inactive',
  Banned = 'banned',
}
```

## ğŸ”Œ index.ts - API æ–¹æ³•å®šä¹‰æ–‡ä»¶

**èŒè´£**ï¼šå®šä¹‰è¯¥æ¨¡å—çš„æ‰€æœ‰ API æ–¹æ³•

### ç¤ºä¾‹ï¼šç”¨æˆ·æ¨¡å— API å®šä¹‰

å‚è€ƒæ–‡ä»¶ï¼š[src/services/user/index.ts](mdc:src/services/user/index.ts)

```typescript
import { http } from '@/utils/request'
import type { UserLoginParams, UserLoginResponse, UserInfo, UserUpdateParams } from './types'

/**
 * ç”¨æˆ·ç›¸å…³ API
 */
export const UserAPI = {
  /**
   * ç”¨æˆ·ç™»å½•
   */
  login(params: UserLoginParams) {
    return http.post<UserLoginResponse>('/user/login', params)
  },

  /**
   * è·å–ç”¨æˆ·ä¿¡æ¯
   */
  getUserInfo() {
    return http.get<UserInfo>('/user/info')
  },

  /**
   * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
   */
  updateUserInfo(data: UserUpdateParams) {
    return http.put<UserInfo>('/user/info', data)
  },

  /**
   * é€€å‡ºç™»å½•
   */
  logout() {
    return http.post<void>('/user/logout')
  },
}

// å¯¼å‡ºç±»å‹ï¼Œæ–¹ä¾¿å¤–éƒ¨ä½¿ç”¨
export type { UserInfo, UserLoginParams, UserLoginResponse, UserUpdateParams } from './types'
```

### API æ–¹æ³•å‘½åè§„èŒƒ

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨æ¸…æ™°çš„åŠ¨è¯
login() // ç™»å½•
logout() // ç™»å‡º
getUserInfo() // è·å–ç”¨æˆ·ä¿¡æ¯
getUserList() // è·å–ç”¨æˆ·åˆ—è¡¨
createUser() // åˆ›å»ºç”¨æˆ·
updateUser() // æ›´æ–°ç”¨æˆ·
deleteUser() // åˆ é™¤ç”¨æˆ·

// âŒ é”™è¯¯ï¼šä¸æ¸…æ™°çš„å‘½å
user() // ä¸æ˜ç¡®
getUser() // è·å–å•ä¸ªè¿˜æ˜¯åˆ—è¡¨ï¼Ÿ
userInfo() // ç¼ºå°‘åŠ¨è¯
```

## ğŸ“¤ ç»Ÿä¸€å¯¼å‡º

åœ¨ `src/services/index.ts` ä¸­ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰æ¨¡å—ï¼š

```typescript
// src/services/index.ts
export * from './user'
export * from './product'
export * from './order'
```

è¿™æ ·å¯ä»¥ä» `@/services` ç›´æ¥å¯¼å…¥ï¼š

```typescript
import { UserAPI, ProductAPI, OrderAPI, type UserInfo } from '@/services'
```

## ğŸš€ åˆ›å»ºæ–°æ¨¡å—æ­¥éª¤

### æ­¥éª¤ 1: åˆ›å»ºç›®å½•ç»“æ„

```bash
mkdir -p src/services/product
```

### æ­¥éª¤ 2: åˆ›å»º types.ts

```typescript
// src/services/product/types.ts

/**
 * äº§å“ç›¸å…³ç±»å‹å®šä¹‰
 */

// äº§å“ä¿¡æ¯
export interface ProductInfo {
  id: number
  name: string
  price: number
  description?: string
  imageUrl?: string
}

// äº§å“åˆ—è¡¨æŸ¥è¯¢å‚æ•°
export interface ProductListParams {
  page?: number
  pageSize?: number
  category?: string
  keyword?: string
}

// äº§å“åˆ—è¡¨å“åº”
export interface ProductListResponse {
  list: ProductInfo[]
  total: number
  page: number
  pageSize: number
}

// åˆ›å»ºäº§å“å‚æ•°
export interface ProductCreateParams {
  name: string
  price: number
  description?: string
  imageUrl?: string
}

// äº§å“ç±»å‹æšä¸¾
export enum ProductType {
  Physical = 'physical',
  Digital = 'digital',
  Service = 'service',
}
```

### æ­¥éª¤ 3: åˆ›å»º index.ts

```typescript
// src/services/product/index.ts
import { http } from '@/utils/request'
import type {
  ProductInfo,
  ProductListParams,
  ProductListResponse,
  ProductCreateParams,
} from './types'

/**
 * äº§å“ç›¸å…³ API
 */
export const ProductAPI = {
  /**
   * è·å–äº§å“åˆ—è¡¨
   */
  getList(params?: ProductListParams) {
    return http.get<ProductListResponse>('/products', { params })
  },

  /**
   * è·å–äº§å“è¯¦æƒ…
   */
  getDetail(id: number) {
    return http.get<ProductInfo>(`/products/${id}`)
  },

  /**
   * åˆ›å»ºäº§å“
   */
  create(data: ProductCreateParams) {
    return http.post<ProductInfo>('/products', data)
  },

  /**
   * æ›´æ–°äº§å“
   */
  update(id: number, data: Partial<ProductCreateParams>) {
    return http.put<ProductInfo>(`/products/${id}`, data)
  },

  /**
   * åˆ é™¤äº§å“
   */
  delete(id: number) {
    return http.delete<void>(`/products/${id}`)
  },
}

// å¯¼å‡ºç±»å‹
export type {
  ProductInfo,
  ProductListParams,
  ProductListResponse,
  ProductCreateParams,
} from './types'
```

### æ­¥éª¤ 4: åœ¨ services/index.ts ä¸­å¯¼å‡º

```typescript
// src/services/index.ts
export * from './user'
export * from './product' // æ–°å¢
export * from './order'
```

### æ­¥éª¤ 5: åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```typescript
import { FC, useEffect, useState } from 'react'
import { ProductAPI, type ProductInfo } from '@/services'
import { Toast } from 'antd-mobile'

const ProductList: FC = () => {
  const [products, setProducts] = useState<ProductInfo[]>([])
  const [loading, setLoading] = useState(false)

  useEffect(() => {
    const fetchProducts = async () => {
      setLoading(true)
      try {
        const res = await ProductAPI.getList({ page: 1, pageSize: 10 })
        setProducts(res.list)
      } catch (error) {
        Toast.show({ content: 'è·å–äº§å“åˆ—è¡¨å¤±è´¥' })
      } finally {
        setLoading(false)
      }
    }
    fetchProducts()
  }, [])

  return (
    <div>
      {products.map(product => (
        <div key={product.id}>{product.name}</div>
      ))}
    </div>
  )
}

export default ProductList
```

## âœ… æœ€ä½³å®è·µ

### 1. ç±»å‹å®šä¹‰

- âœ… ä½¿ç”¨æœ‰æ„ä¹‰çš„ç±»å‹åç§°
- âœ… ä¸ºæ¯ä¸ªç±»å‹æ·»åŠ  JSDoc æ³¨é‡Š
- âœ… ä½¿ç”¨ `interface` å®šä¹‰å¯¹è±¡ç±»å‹
- âœ… ä½¿ç”¨ `type` å®šä¹‰è”åˆç±»å‹ã€äº¤å‰ç±»å‹ç­‰
- âœ… å¯é€‰å±æ€§ä½¿ç”¨ `?`
- âœ… å¯¼å‡ºæ‰€æœ‰éœ€è¦åœ¨æ¨¡å—å¤–éƒ¨ä½¿ç”¨çš„ç±»å‹
- âœ… **ç±»å‹åå¿…é¡»ä½¿ç”¨æ¨¡å—å‰ç¼€**ï¼ˆé¿å…å†²çªï¼‰

### 2. API æ–¹æ³•

- âœ… ä½¿ç”¨ç»Ÿä¸€çš„å‘½åè§„èŒƒï¼š`æ¨¡å—åAPI`ï¼ˆå¦‚ `UserAPI`ã€`ProductAPI`ï¼‰
- âœ… æ¯ä¸ªæ–¹æ³•éƒ½æœ‰æ¸…æ™°çš„ JSDoc æ³¨é‡Š
- âœ… ä½¿ç”¨ç±»å‹å¯¼å…¥ï¼ˆ`import type`ï¼‰æé«˜æ€§èƒ½
- âœ… åœ¨æ–‡ä»¶æœ«å°¾ç»Ÿä¸€å¯¼å‡ºç±»å‹
- âœ… ä½¿ç”¨ `http` å·¥å…·å‡½æ•°è¿›è¡Œè¯·æ±‚
- âœ… ä¸ºæ‰€æœ‰ HTTP æ–¹æ³•æŒ‡å®šè¿”å›ç±»å‹æ³›å‹

### 3. å¯¼å…¥å¯¼å‡º

- âœ… åœ¨ `src/services/index.ts` ä¸­ç»Ÿä¸€å¯¼å‡º
- âœ… ä½¿ç”¨ `export *` å¯¼å‡ºæ¨¡å—çš„æ‰€æœ‰å†…å®¹
- âœ… ç±»å‹å’Œ API æ–¹æ³•éƒ½å¯ä»¥ä» `@/services` å¯¼å…¥

```typescript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
import { UserAPI, ProductAPI, type UserInfo, type ProductInfo } from '@/services'
```

### 4. ç±»å‹å¤ç”¨

å¯¹äºè·¨æ¨¡å—ä½¿ç”¨çš„é€šç”¨ç±»å‹ï¼Œåº”è¯¥æå–åˆ°å…¬å…±ç±»å‹æ–‡ä»¶ï¼š

```typescript
// src/services/types/common.ts

/**
 * é€šç”¨ç±»å‹å®šä¹‰
 */

// åˆ†é¡µå‚æ•°ï¼ˆå¤šä¸ªæ¨¡å—ä½¿ç”¨ï¼‰
export interface PaginationParams {
  page: number
  pageSize: number
}

// åˆ†é¡µå“åº”ï¼ˆå¤šä¸ªæ¨¡å—ä½¿ç”¨ï¼‰
export interface PaginationResponse<T> {
  list: T[]
  total: number
  page: number
  pageSize: number
}
```

ç„¶ååœ¨å„æ¨¡å—ä¸­ä½¿ç”¨ï¼š

```typescript
// src/services/user/types.ts
import type { PaginationParams, PaginationResponse } from '../types/common'

export interface UserListParams extends PaginationParams {
  status?: UserStatus
  keyword?: string
}

export type UserListResponse = PaginationResponse<UserInfo>
```

## ğŸš« å¸¸è§é”™è¯¯

### âŒ é”™è¯¯ç¤ºä¾‹

```typescript
// é”™è¯¯ 1: æ²¡æœ‰æ¨¡å—å‰ç¼€
export interface Info {}
export interface Params {}

// é”™è¯¯ 2: æ¨¡å—å‰ç¼€ä¸ä¸€è‡´
export interface UserInfo {}
export interface ProductInfo {}
export interface OrderData {} // åº”è¯¥ç”¨ OrderInfo

// é”™è¯¯ 3: å‘½åä¸æ¸…æ™°
export interface UserParams {} // åº”è¯¥ç”¨ UserLoginParams æˆ– UserUpdateParams

// é”™è¯¯ 4: æ²¡æœ‰å¯¼å‡ºç±»å‹
export const UserAPI = {
  login(params: UserLoginParams) {},
}
// ç¼ºå°‘: export type { UserLoginParams } from './types'

// é”™è¯¯ 5: ä½¿ç”¨ any
export const UserAPI = {
  login(params: any) {
    // åº”è¯¥ä½¿ç”¨å…·ä½“ç±»å‹
    return http.post('/user/login', params)
  },
}
```

### âœ… æ­£ç¡®ç¤ºä¾‹

```typescript
// æ­£ç¡®: ä½¿ç”¨æ¨¡å—å‰ç¼€
export interface UserInfo {}
export interface ProductInfo {}
export interface OrderInfo {}

// æ­£ç¡®: æ¸…æ™°çš„å‘½å
export interface UserLoginParams {}
export interface UserUpdateParams {}
export interface ProductCreateParams {}

// æ­£ç¡®: å¯¼å‡ºç±»å‹
export const UserAPI = {
  login(params: UserLoginParams) {
    return http.post<UserLoginResponse>('/user/login', params)
  },
}
export type { UserLoginParams, UserLoginResponse } from './types'
```

## ğŸ” HTTP è¯·æ±‚å·¥å…·

é¡¹ç›®å·²å°è£… Axios è¯·æ±‚å·¥å…·ï¼Œä½äº [src/utils/request.ts](mdc:src/utils/request.ts)

### æ”¯æŒçš„æ–¹æ³•

```typescript
// GET è¯·æ±‚
http.get<ResponseType>(url, config)

// POST è¯·æ±‚
http.post<ResponseType>(url, data, config)

// PUT è¯·æ±‚
http.put<ResponseType>(url, data, config)

// DELETE è¯·æ±‚
http.delete<ResponseType>(url, config)

// PATCH è¯·æ±‚
http.patch<ResponseType>(url, data, config)
```

### ç‰¹æ€§

- âœ… è‡ªåŠ¨æ·»åŠ  token åˆ°è¯·æ±‚å¤´
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†
- âœ… è¯·æ±‚/å“åº”æ‹¦æˆªå™¨
- âœ… 401 è‡ªåŠ¨ç™»å‡º
- âœ… TypeScript ç±»å‹æ”¯æŒ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API å¼€å‘è§„èŒƒè¯¦ç»†æ–‡æ¡£](mdc:docs/API_GUIDE.md)
- [HTTP è¯·æ±‚å·¥å…·](mdc:src/utils/request.ts)
- [ç”¨æˆ·æ¨¡å—ç¤ºä¾‹](mdc:src/services/user)
- [ä»£ç è§„èŒƒ](mdc:.cursor/rules/code-standards.mdc)
