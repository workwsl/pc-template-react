---
globs: src/**/*.{tsx,jsx}
description: React ç»„ä»¶å¼€å‘è§„èŒƒ - ç»„ä»¶ç»“æ„ã€Hooks ä½¿ç”¨ã€Props è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–
---

# React å¼€å‘è§„èŒƒ

## ğŸ“¦ ç»„ä»¶åˆ†ç±»

### 1. é€šç”¨ç»„ä»¶ï¼ˆCommon Componentsï¼‰

å­˜æ”¾ä½ç½®ï¼š`src/components/Common/`

**ç‰¹ç‚¹**ï¼š

- çº¯ UI ç»„ä»¶ï¼Œæ— ä¸šåŠ¡é€»è¾‘
- é«˜åº¦å¯å¤ç”¨
- å®Œå–„çš„ Props ç±»å‹å®šä¹‰
- æä¾›é»˜è®¤å€¼

```typescript
// âœ… ç¤ºä¾‹ï¼šé€šç”¨æŒ‰é’®ç»„ä»¶
import { FC, ReactNode } from 'react'
import classNames from 'classnames'
import styles from './index.module.less'

interface ButtonProps {
  /** æŒ‰é’®ç±»å‹ */
  type?: 'primary' | 'default' | 'danger'
  /** æŒ‰é’®å¤§å° */
  size?: 'small' | 'medium' | 'large'
  /** æ˜¯å¦ç¦ç”¨ */
  disabled?: boolean
  /** æŒ‰é’®å†…å®¹ */
  children: ReactNode
  /** ç‚¹å‡»äº‹ä»¶ */
  onClick?: () => void
}

const Button: FC<ButtonProps> = ({
  type = 'default',
  size = 'medium',
  disabled = false,
  children,
  onClick,
}) => {
  const handleClick = () => {
    if (disabled) return
    onClick?.()
  }

  return (
    <button
      className={classNames(
        styles.button,
        styles[`button__${type}`],
        styles[`button__${size}`],
        { [styles.button__disabled]: disabled }
      )}
      onClick={handleClick}
      disabled={disabled}
    >
      {children}
    </button>
  )
}

export default Button
```

### 2. ä¸šåŠ¡ç»„ä»¶ï¼ˆBusiness Componentsï¼‰

å­˜æ”¾ä½ç½®ï¼š`src/components/Business/`

**ç‰¹ç‚¹**ï¼š

- åŒ…å«ä¸šåŠ¡é€»è¾‘
- å¯èƒ½è°ƒç”¨ API
- å¯èƒ½ä½¿ç”¨å…¨å±€çŠ¶æ€
- åœ¨å¤šä¸ªé¡µé¢å¤ç”¨

```typescript
// âœ… ç¤ºä¾‹ï¼šç”¨æˆ·å¡ç‰‡ä¸šåŠ¡ç»„ä»¶
import { FC } from 'react'
import { useNavigate } from 'react-router-dom'
import { Card, Avatar } from 'antd'
import { useUserStore } from '@/store'
import styles from './index.module.less'

interface UserCardProps {
  userId: number
  showActions?: boolean
}

const UserCard: FC<UserCardProps> = ({ userId, showActions = true }) => {
  const navigate = useNavigate()
  const { userInfo } = useUserStore()

  const handleViewProfile = () => {
    navigate(`/user/${userId}`)
  }

  return (
    <Card className={styles.userCard}>
      <div className={styles.userCard_header}>
        <Avatar src={userInfo?.avatar} />
        <div className={styles.userCard_info}>
          <h3>{userInfo?.username}</h3>
          <p>{userInfo?.email}</p>
        </div>
      </div>
      {showActions && (
        <div className={styles.userCard_actions}>
          <button onClick={handleViewProfile}>æŸ¥çœ‹è¯¦æƒ…</button>
        </div>
      )}
    </Card>
  )
}

export default UserCard
```

### 3. é¡µé¢ç»„ä»¶ï¼ˆPage Componentsï¼‰

å­˜æ”¾ä½ç½®ï¼š`src/pages/{pageName}/`

**ç‰¹ç‚¹**ï¼š

- å¯¹åº”è·¯ç”±
- ç»„ç»‡é¡µé¢ç»“æ„
- åè°ƒå­ç»„ä»¶
- å¤„ç†é¡µé¢çº§çŠ¶æ€

## ğŸ—ï¸ ç»„ä»¶ä»£ç ç»“æ„

```typescript
// 1. å¯¼å…¥ç¬¬ä¸‰æ–¹åº“
import { FC, useState, useEffect, useMemo, useCallback } from 'react'
import { useNavigate, useParams } from 'react-router-dom'
import { Button, message } from 'antd'

// 2. å¯¼å…¥é¡¹ç›®å†…éƒ¨æ¨¡å—
import { useRequest } from '@/hooks'
import { UserAPI } from '@/services'
import { useUserStore } from '@/store'

// 3. å¯¼å…¥ç±»å‹å®šä¹‰
import type { User } from '@/services'

// 4. å¯¼å…¥æ ·å¼
import styles from './index.module.less'

// 5. å®šä¹‰ç±»å‹
interface ComponentProps {
  userId: number
  onUserLoad?: (user: User) => void
}

// 6. å®šä¹‰å¸¸é‡
const DEFAULT_PAGE_SIZE = 10

// 7. ç»„ä»¶å®šä¹‰
const UserProfile: FC<ComponentProps> = ({ userId, onUserLoad }) => {
  // 7.1 Hooksï¼ˆRouterã€Store ç­‰ï¼‰
  const navigate = useNavigate()
  const { userInfo } = useUserStore()

  // 7.2 State
  const [loading, setLoading] = useState(false)
  const [data, setData] = useState<User | null>(null)

  // 7.3 Computed valuesï¼ˆuseMemoï¼‰
  const displayName = useMemo(() => {
    return data?.username || 'æœªå‘½åç”¨æˆ·'
  }, [data])

  // 7.4 Methodsï¼ˆuseCallbackï¼‰
  const handleRefresh = useCallback(() => {
    setLoading(true)
    // åˆ·æ–°é€»è¾‘
  }, [])

  // 7.5 Effects
  useEffect(() => {
    const fetchUser = async () => {
      const user = await UserAPI.getUserInfo()
      setData(user)
      onUserLoad?.(user)
    }
    fetchUser()
  }, [userId, onUserLoad])

  // 7.6 Render
  return (
    <div className={styles.userProfile}>
      <h1>{displayName}</h1>
      <Button onClick={handleRefresh}>åˆ·æ–°</Button>
    </div>
  )
}

// 8. å¯¼å‡º
export default UserProfile
```

## ğŸª Hooks ä½¿ç”¨è§„èŒƒ

### 1. Hooks è°ƒç”¨é¡ºåº

```typescript
// âœ… æ­£ç¡®ï¼šHooks åœ¨ç»„ä»¶é¡¶å±‚è°ƒç”¨
const Component: FC = () => {
  const navigate = useNavigate()
  const { userInfo } = useUserStore()
  const [count, setCount] = useState(0)

  // ...
}

// âŒ é”™è¯¯ï¼šåœ¨æ¡ä»¶è¯­å¥ä¸­è°ƒç”¨ Hooks
const Component: FC = () => {
  if (condition) {
    const [count, setCount] = useState(0) // é”™è¯¯ï¼
  }
}

// âŒ é”™è¯¯ï¼šåœ¨å¾ªç¯ä¸­è°ƒç”¨ Hooks
const Component: FC = () => {
  for (let i = 0; i < 10; i++) {
    const [count, setCount] = useState(0) // é”™è¯¯ï¼
  }
}
```

### 2. useState ä½¿ç”¨

```typescript
// âœ… æ­£ç¡®ï¼šæ˜ç¡®çš„çŠ¶æ€å‘½å
const [isLoading, setIsLoading] = useState(false)
const [userList, setUserList] = useState<User[]>([])
const [formData, setFormData] = useState<FormData>({
  username: '',
  email: '',
})

// âœ… æ­£ç¡®ï¼šä½¿ç”¨å‡½æ•°å¼æ›´æ–°
setCount(prevCount => prevCount + 1)
setUserList(prevList => [...prevList, newUser])

// âŒ é”™è¯¯ï¼šç›´æ¥ä¿®æ”¹çŠ¶æ€
userList.push(newUser) // é”™è¯¯ï¼
setUserList(userList) // ä¸ä¼šè§¦å‘æ›´æ–°
```

### 3. useEffect ä½¿ç”¨

```typescript
// âœ… æ­£ç¡®ï¼šæ˜ç¡®ä¾èµ–é¡¹
useEffect(() => {
  fetchData(userId)
}, [userId])

// âœ… æ­£ç¡®ï¼šæ¸…ç†å‰¯ä½œç”¨
useEffect(() => {
  const timer = setInterval(() => {
    console.log('tick')
  }, 1000)

  return () => {
    clearInterval(timer)
  }
}, [])

// âŒ é”™è¯¯ï¼šç¼ºå°‘ä¾èµ–é¡¹
useEffect(() => {
  fetchData(userId) // userId åº”è¯¥åœ¨ä¾èµ–é¡¹ä¸­
}, [])

// âŒ é”™è¯¯ï¼šä¾èµ–é¡¹è¿‡å¤šå¯¼è‡´é¢‘ç¹æ‰§è¡Œ
useEffect(() => {
  // ...
}, [obj]) // å¯¹è±¡å¼•ç”¨æ¯æ¬¡éƒ½å˜åŒ–
```

### 4. useCallback å’Œ useMemo

```typescript
// âœ… æ­£ç¡®ï¼šç¼“å­˜å‡½æ•°é¿å…å­ç»„ä»¶é‡æ¸²æŸ“
const handleClick = useCallback(() => {
  console.log(count)
}, [count])

// âœ… æ­£ç¡®ï¼šç¼“å­˜è®¡ç®—ç»“æœ
const sortedUsers = useMemo(() => {
  return users.sort((a, b) => a.name.localeCompare(b.name))
}, [users])

// âŒ é”™è¯¯ï¼šè¿‡åº¦ä½¿ç”¨ï¼ˆç®€å•å‡½æ•°ä¸éœ€è¦ç¼“å­˜ï¼‰
const handleClick = useCallback(() => {
  console.log('clicked') // ç®€å•å‡½æ•°ä¸éœ€è¦ç¼“å­˜
}, [])

// âŒ é”™è¯¯ï¼šç¼ºå°‘ä¾èµ–
const handleClick = useCallback(() => {
  console.log(count) // count åº”è¯¥åœ¨ä¾èµ–é¡¹ä¸­
}, [])
```

### 5. ä½¿ç”¨ ahooks

é¡¹ç›®é›†æˆäº† [ahooks](https://ahooks.js.org/)ï¼Œä¼˜å…ˆä½¿ç”¨å…¶æä¾›çš„ Hooksï¼š

```typescript
import { useRequest, useDebounce, useLocalStorageState } from '@/hooks'
import { UserAPI } from '@/services'

const Component: FC = () => {
  // âœ… ä½¿ç”¨ useRequest ç®¡ç†è¯·æ±‚
  const { data, loading, run } = useRequest(UserAPI.getUserInfo)

  // âœ… ä½¿ç”¨ useDebounce é˜²æŠ–
  const [searchText, setSearchText] = useState('')
  const debouncedSearch = useDebounce(searchText, { wait: 500 })

  // âœ… ä½¿ç”¨ useLocalStorageState æŒä¹…åŒ–çŠ¶æ€
  const [theme, setTheme] = useLocalStorageState('theme', {
    defaultValue: 'light',
  })

  // ...
}
```

## ğŸ¨ Props è®¾è®¡è§„èŒƒ

### 1. Props ç±»å‹å®šä¹‰

```typescript
// âœ… æ­£ç¡®ï¼šå®Œæ•´çš„ç±»å‹å®šä¹‰å’Œæ³¨é‡Š
interface UserCardProps {
  /** ç”¨æˆ· ID */
  userId: number
  /** æ˜¯å¦æ˜¾ç¤ºå¤´åƒ */
  showAvatar?: boolean
  /** ç”¨æˆ·ç‚¹å‡»å›è°ƒ */
  onUserClick?: (userId: number) => void
}

// âŒ é”™è¯¯ï¼šä½¿ç”¨ any æˆ–ç¼ºå°‘æ³¨é‡Š
interface UserCardProps {
  userId: any
  showAvatar?: boolean
  onClick?: any
}
```

### 2. Props é»˜è®¤å€¼

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨è§£æ„èµ‹å€¼è®¾ç½®é»˜è®¤å€¼
const Button: FC<ButtonProps> = ({
  type = 'default',
  size = 'medium',
  disabled = false,
  children,
  onClick,
}) => {
  // ...
}

// âŒ é”™è¯¯ï¼šåœ¨å‡½æ•°ä½“å†…è®¾ç½®é»˜è®¤å€¼
const Button: FC<ButtonProps> = props => {
  const type = props.type || 'default' // ä¸æ¨è
  const size = props.size || 'medium' // ä¸æ¨è
  // ...
}
```

### 3. Props éªŒè¯

```typescript
// âœ… æ­£ç¡®ï¼šå¿…éœ€çš„ Props ä¸è®¾ç½®å¯é€‰æ ‡è®°
interface UserListProps {
  users: User[] // å¿…éœ€
  pageSize?: number // å¯é€‰
  onUserSelect: (user: User) => void // å¿…éœ€çš„å›è°ƒ
}

// âŒ é”™è¯¯ï¼šæ‰€æœ‰ Props éƒ½è®¾ä¸ºå¯é€‰
interface UserListProps {
  users?: User[]
  pageSize?: number
  onUserSelect?: (user: User) => void
}
```

## ğŸ¯ JSX ç¼–å†™è§„èŒƒ

### 1. ç»„ä»¶å±æ€§

```typescript
// âœ… æ­£ç¡®ï¼šå¤šä¸ªå±æ€§æ—¶æ¢è¡Œ
<Button
  type="primary"
  size="large"
  disabled={isLoading}
  onClick={handleClick}
>
  Submit
</Button>

// âœ… å•ä¸ªå±æ€§æ—¶å¯ä»¥å•è¡Œ
<Button type="primary">Submit</Button>

// âŒ é”™è¯¯ï¼šå¤šä¸ªå±æ€§æŒ¤åœ¨ä¸€è¡Œ
<Button type="primary" size="large" disabled={isLoading} onClick={handleClick}>Submit</Button>
```

### 2. æ¡ä»¶æ¸²æŸ“

```typescript
// âœ… æ­£ç¡®ï¼šç®€å•æ¡ä»¶ä½¿ç”¨ä¸‰å…ƒæˆ– &&
{isLoading ? <Loading /> : <Content />}
{isError && <ErrorMessage />}

// âœ… æ­£ç¡®ï¼šå¤æ‚æ¡ä»¶æå–ä¸ºå‡½æ•°
const renderContent = () => {
  if (isLoading) return <Loading />
  if (isError) return <ErrorMessage />
  return <Content />
}

return <div>{renderContent()}</div>

// âŒ é”™è¯¯ï¼šåœ¨ JSX ä¸­å†™å¤æ‚é€»è¾‘
{isLoading ? <Loading /> : isError ? <ErrorMessage /> : hasData ? <Content /> : <Empty />}
```

### 3. åˆ—è¡¨æ¸²æŸ“

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¨³å®šçš„ key
{users.map(user => (
  <UserCard key={user.id} user={user} />
))}

// âŒ é”™è¯¯ï¼šä½¿ç”¨ index ä½œä¸º key
{users.map((user, index) => (
  <UserCard key={index} user={user} />
))}
```

### 4. äº‹ä»¶å¤„ç†

```typescript
// âœ… æ­£ç¡®ï¼šä¸éœ€è¦å‚æ•°æ—¶ç›´æ¥ä¼ é€’å‡½æ•°
<Button onClick={handleClick}>Click</Button>

// âœ… æ­£ç¡®ï¼šéœ€è¦å‚æ•°æ—¶ä½¿ç”¨ç®­å¤´å‡½æ•°
<Button onClick={() => handleDelete(user.id)}>Delete</Button>

// âœ… æ›´å¥½ï¼šä½¿ç”¨ useCallback ä¼˜åŒ–
const handleDelete = useCallback((id: number) => {
  // åˆ é™¤é€»è¾‘
}, [])

<Button onClick={() => handleDelete(user.id)}>Delete</Button>

// âŒ é”™è¯¯ï¼šç›´æ¥è°ƒç”¨å‡½æ•°
<Button onClick={handleClick()}>Click</Button>
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. é¿å…ä¸å¿…è¦çš„æ¸²æŸ“

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ React.memo
const UserCard = React.memo<UserCardProps>(({ user }) => {
  return <div>{user.name}</div>
})

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—ç»“æœ
const sortedUsers = useMemo(() => {
  return users.sort((a, b) => a.name.localeCompare(b.name))
}, [users])

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ useCallback ç¼“å­˜å‡½æ•°
const handleUserClick = useCallback((userId: number) => {
  navigate(`/user/${userId}`)
}, [navigate])
```

### 2. åˆ—è¡¨ä¼˜åŒ–

```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¨³å®šçš„ key
{users.map(user => (
  <UserCard key={user.id} user={user} />
))}

// âœ… æ­£ç¡®ï¼šå¤§é‡æ•°æ®ä½¿ç”¨è™šæ‹Ÿåˆ—è¡¨
import { List } from 'react-virtualized'

<List
  width={300}
  height={600}
  rowCount={users.length}
  rowHeight={50}
  rowRenderer={({ index, key, style }) => (
    <div key={key} style={style}>
      <UserCard user={users[index]} />
    </div>
  )}
/>
```

### 3. æ‡’åŠ è½½

```typescript
// âœ… æ­£ç¡®ï¼šè·¯ç”±æ‡’åŠ è½½
import { lazy, Suspense } from 'react'

const UserProfile = lazy(() => import('@/pages/userProfile'))

<Suspense fallback={<Loading />}>
  <UserProfile />
</Suspense>
```

## ğŸš« é¿å…çš„åšæ³•

1. **é¿å…ä½¿ç”¨ any**ï¼šå¤±å»ç±»å‹å®‰å…¨
2. **é¿å…åœ¨ JSX ä¸­å†™å¤æ‚é€»è¾‘**ï¼šå½±å“å¯è¯»æ€§
3. **é¿å…ç›´æ¥ä¿®æ”¹ state**ï¼šç ´åä¸å¯å˜æ€§
4. **é¿å…è¿‡åº¦ä¼˜åŒ–**ï¼šä¸è¦è¿‡æ—©ä¼˜åŒ–
5. **é¿å…æ·±å±‚åµŒå¥—**ï¼šç»„ä»¶åµŒå¥—ä¸è¶…è¿‡ 3 å±‚
6. **é¿å…ä½¿ç”¨ index ä½œä¸º key**ï¼šå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜
7. **é¿å…åœ¨å¾ªç¯ä¸­å®šä¹‰ç»„ä»¶**ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»ºæ–°ç»„ä»¶
8. **é¿å…æ»¥ç”¨ Context**ï¼šåªç”¨äºçœŸæ­£å…¨å±€çš„çŠ¶æ€
9. **é¿å…åœ¨ useEffect ä¸­ç¼ºå°‘ä¾èµ–**ï¼šå¯èƒ½å¯¼è‡´ bug
10. **é¿å…å¿½ç•¥ ESLint è­¦å‘Š**ï¼šè­¦å‘Šé€šå¸¸æœ‰æ„ä¹‰

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [React å®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [ahooks æ–‡æ¡£](https://ahooks.js.org/)
- [é¡¹ç›® React å¼€å‘è§„èŒƒ](mdc:docs/REACT_GUIDE.md)
- [ä»£ç è§„èŒƒ](mdc:.cursor/rules/code-standards.mdc)
